<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حاسبة التشغيل - Interpolation</title>
    <style>
        /* تنسيق الصفحة (ستايل داكن نفس الصورة) */
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* كرت الادخال */
        .card {
            background-color: #1e1e2e;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border-top: 3px solid #4ade80;
        }
        label {
            display: block;
            color: #a0a0a0;
            font-size: 12px;
            margin-bottom: 5px;
            font-weight: bold;
        }
        select, input {
            width: 100%;
            background-color: #2a2a35;
            border: 1px solid #3a3a45;
            color: white;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
            margin-bottom: 15px;
        }
        .btn-calc {
            background-color: #0d47a1;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            font-weight: bold;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-calc:active { background-color: #0b3c85; }
        
        /* كرت النتائج */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .summary-badge {
            background-color: #4ade80;
            color: #000;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 13px;
        }
        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }
        .result-row:last-child { border-bottom: none; }
        .res-label { color: #ccc; font-size: 14px; }
        .res-value { font-weight: bold; font-size: 15px; color: #fff; }
        .unit-small { font-size: 10px; color: #888; }
    </style>
</head>
<body>

<div class="container">

    <div class="card">
        <label>نوع النفط</label>
        <select id="oilType">
            <option value="KEC">KEC</option>
        </select>

        <label>وضع التشغيل</label>
        <select id="opMode">
            <option value="diesel">مع ديزل ثقيل</option>
        </select>

        <label>وحدة الإدخال</label>
        <select id="inputUnit">
            <option value="sm3">sm3/h</option>
            <option value="kbpd">KBPD</option>
        </select>

        <label>كمية التكرير</label>
        <input type="number" id="inputQty" placeholder="أدخل القيمة هنا" value="1342">

        <button class="btn-calc" onclick="calculateResults()">احسب</button>
    </div>

    <div class="card" id="resultsCard" style="display: block;">
        <div class="results-header">
            <span style="color:#4ade80; font-size: 14px;">معايير التشغيل</span>
            <span class="summary-badge" id="summaryDisplay">0 sm3/h</span>
        </div>

        <div class="result-row">
            <span class="res-value" id="res_crude">0 <span class="unit-small">sm3/h</span></span>
            <span class="res-label">Crude Feed (Tank)</span>
        </div>
        <div class="result-row">
            <span class="res-value" id="res_slops">0 <span class="unit-small">sm3/h</span></span>
            <span class="res-label">Slops</span>
        </div>
        <div class="result-row">
            <span class="res-value" id="res_naphtha">0 <span class="unit-small">sm3/h</span></span>
            <span class="res-label">Wild Naphtha</span>
        </div>
        <div class="result-row">
            <span class="res-value" id="res_heater">0 <span class="unit-small">sm3/h</span></span>
            <span class="res-label">Heater Feed Rate</span>
        </div>
        </div>

</div>

<script>
    // ==========================================
    // 1. جدول البيانات (هنا تنسخ قيم الاكسل)
    // ==========================================
    /* تنبيه: تأكد انك تعبي الجدول بالترتيب (من الأصغر للأكبر) بناء على sm3
       sm3: القيمة بالمتر المكعب
       kbpd: القيمة بالبرميل
       slops: قيمة السلوبس المقابلة
       naphtha: قيمة النافثا المقابلة
       heater: قيمة السخان المقابلة
    */
    const tableData = [
        { sm3: 1000, kbpd: 150.9, slops: 25.5, naphtha: 7.2, heater: 915.0 },
        { sm3: 1200, kbpd: 181.1, slops: 30.0, naphtha: 8.5, heater: 1095.5 },
        // هذا السطر اللي بالصورة عندك (تم وضعه كثابت)
        { sm3: 1342, kbpd: 202.6, slops: 34.6, naphtha: 9.6, heater: 1225.2 }, 
        { sm3: 1400, kbpd: 211.3, slops: 36.2, naphtha: 10.1, heater: 1278.0 },
        { sm3: 1600, kbpd: 241.5, slops: 41.5, naphtha: 11.5, heater: 1460.0 }
    ];

    function calculateResults() {
        // 1. قراءة المدخلات
        const qty = parseFloat(document.getElementById('inputQty').value);
        const unit = document.getElementById('inputUnit').value; // 'sm3' or 'kbpd'

        if (isNaN(qty)) return alert("يرجى إدخال رقم صحيح");

        // 2. عملية الاستكمال الخطي (Interpolation)
        const result = interpolate(qty, unit);

        // 3. عرض النتائج
        // تحديث البادج العلوي
        let summaryText = "";
        if(unit === 'sm3') {
            summaryText = `${qty} sm3/h (${result.kbpd.toFixed(1)} KBPD)`;
        } else {
            summaryText = `${result.sm3.toFixed(1)} sm3/h (${qty} KBPD)`;
        }
        document.getElementById('summaryDisplay').innerText = summaryText;

        // تحديث الجدول
        document.getElementById('res_crude').innerHTML = `${result.sm3.toFixed(1)} <span class="unit-small">sm3/h</span>`;
        document.getElementById('res_slops').innerHTML = `${result.slops.toFixed(1)} <span class="unit-small">sm3/h</span>`;
        document.getElementById('res_naphtha').innerHTML = `${result.naphtha.toFixed(1)} <span class="unit-small">sm3/h</span>`;
        document.getElementById('res_heater').innerHTML = `${result.heater.toFixed(1)} <span class="unit-small">sm3/h</span>`;
    }

    // دالة الحساب الرئيسية (القلب النابض للكود)
    function interpolate(inputValue, inputKey) {
        // inputKey هو المفتاح اللي نبحث عنه ('sm3' او 'kbpd')
        
        // فرز البيانات للتأكد (اختياري اذا الجدول مرتب)
        // tableData.sort((a, b) => a[inputKey] - b[inputKey]);

        // البحث عن النقاط المحيطة (Lower & Upper Bounds)
        let lower = tableData[0];
        let upper = tableData[tableData.length - 1];

        // اذا القيمة خارج النطاق (أقل من أقل قيمة أو أكبر من أكبر قيمة)
        // الخوارزمية بتسوي Extrapolation تلقائياً بنفس المعادلة
        
        for (let i = 0; i < tableData.length - 1; i++) {
            const val1 = tableData[i][inputKey];
            const val2 = tableData[i+1][inputKey];

            if (inputValue >= val1 && inputValue <= val2) {
                lower = tableData[i];
                upper = tableData[i+1];
                break;
            }
        }

        // حساب النسبة (Factor)
        // المعادلة: (القيمة المدخلة - القيمة الصغرى) / (القيمة الكبرى - القيمة الصغرى)
        const denominator = upper[inputKey] - lower[inputKey];
        
        // منع القسمة على صفر
        if (denominator === 0) return lower; 

        const ratio = (inputValue - lower[inputKey]) / denominator;

        // تكوين كائن النتيجة الجديد
        const interpolatedResult = {};

        // نمر على كل الأعمدة (keys) ونحسب قيمتها بناء على النسبة
        Object.keys(lower).forEach(key => {
            const valLower = lower[key];
            const valUpper = upper[key];
            // المعادلة: القيمة = الأدنى + (النسبة * الفرق)
            interpolatedResult[key] = valLower + (ratio * (valUpper - valLower));
        });

        return interpolatedResult;
    }

    // تشغيل الحساب عند فتح الصفحة
    calculateResults();
</script>

</body>
</html>
